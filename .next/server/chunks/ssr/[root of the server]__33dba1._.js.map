{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 15, "column": 0}, "map": {"version":3,"sources":["file://D%3A/PP_2/12345%20%E2%80%94%20%D0%BA%D0%BE%D0%BF%D0%B8%D1%8F%20%E2%80%94%20%D0%BA%D0%BE%D0%BF%D0%B8%D1%8F/rater/src/app/supabase/supabaseClient.ts"],"sourcesContent":["import { createClient } from '@supabase/supabase-js';\r\n\r\nconst supabaseUrl = process.env.SUPABASE_URL!;\r\nconst supabaseKey = process.env.SUPABASE_SERVICE_ROLE_KEY!; // для сервера лучше сервисный ключ\r\n\r\nexport const supabase = createClient(supabaseUrl, supabaseKey);\r\n"],"names":[],"mappings":";;;AAAA;;AAEA,MAAM,cAAc,QAAQ,GAAG,CAAC,YAAY;AAC5C,MAAM,cAAc,QAAQ,GAAG,CAAC,yBAAyB,EAAG,mCAAmC;AAExF,MAAM,WAAW,CAAA,GAAA,iQAAA,CAAA,eAAY,AAAD,EAAE,aAAa"}},
    {"offset": {"line": 23, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 29, "column": 0}, "map": {"version":3,"sources":["file://D%3A/PP_2/12345%20%E2%80%94%20%D0%BA%D0%BE%D0%BF%D0%B8%D1%8F%20%E2%80%94%20%D0%BA%D0%BE%D0%BF%D0%B8%D1%8F/rater/src/app/addProduct/page.tsx"],"sourcesContent":["\r\n// import { db } from \"~/server/db\";\r\n// import { createProduct } from \"../api/action/product\";\r\n\r\n// export default async function AddProductPage() {\r\n//   const catalog = await db.category.findMany();\r\n\r\n//   return (\r\n//     <div className=\"p-6 max-w-2xl mx-auto bg-white shadow-lg rounded-lg\">\r\n//       <h1 className=\"text-3xl font-bold mb-6 text-center\">Добавить новый товар</h1>\r\n\r\n//       <form className=\"space-y-6\" action={createProduct}>\r\n//         <div>\r\n//           <label htmlFor=\"name\" className=\"label font-semibold\">Название товара</label>\r\n//           <input\r\n//             id=\"name\"\r\n//             name=\"name\"\r\n//             required\r\n//             className=\"input input-bordered w-full p-3 rounded-md border-gray-300 focus:ring-2 focus:ring-purple-400\"\r\n//             placeholder=\"Введите название товара\"\r\n//           />\r\n//         </div>\r\n\r\n//         <div>\r\n//           <label htmlFor=\"description\" className=\"label font-semibold\">Описание</label>\r\n//           <textarea\r\n//             id=\"description\"\r\n//             name=\"description\"\r\n//             required\r\n//             className=\"textarea textarea-bordered w-full p-3 rounded-md border-gray-300 focus:ring-2 focus:ring-purple-400\"\r\n//             placeholder=\"Введите описание товара\"\r\n//             rows={4}\r\n//           />\r\n//         </div>\r\n\r\n//         <div>\r\n//           <label htmlFor=\"price\" className=\"label font-semibold\">Цена</label>\r\n//           <input\r\n//             id=\"price\"\r\n//             name=\"price\"\r\n//             type=\"number\"\r\n//             required\r\n//             className=\"input input-bordered w-full p-3 rounded-md border-gray-300 focus:ring-2 focus:ring-purple-400\"\r\n//             placeholder=\"Введите цену товара\"\r\n//           />\r\n//         </div>\r\n\r\n//         <div>\r\n//   <label htmlFor=\"image\" className=\"label font-semibold\">Изображение товара</label>\r\n//   <input\r\n//     id=\"image\"\r\n//     name=\"image\"\r\n//     type=\"file\"\r\n//     accept=\"image/*\"\r\n//     required\r\n//     className=\"file-input file-input-bordered w-full p-3 rounded-md border-gray-300\"\r\n//   />\r\n// </div>\r\n\r\n//         <div>\r\n//           <label htmlFor=\"categoryId\" className=\"label font-semibold\">Категория товара</label>\r\n//           <select\r\n//             id=\"categoryId\"\r\n//             name=\"categoryId\"\r\n//             required\r\n//             className=\"select select-bordered w-full p-3 rounded-md border-gray-300 focus:ring-2 focus:ring-purple-400\"\r\n//           >\r\n//             <option value=\"\">Выберите категорию</option>\r\n//             {catalog.map((category) => (\r\n//               <option key={category.id} value={category.id}>\r\n//                 {category.name}\r\n//               </option>\r\n//             ))}\r\n//           </select>\r\n//         </div>\r\n\r\n//         <div className=\"flex justify-center\">\r\n//           <button\r\n//             type=\"submit\"\r\n//             className=\"btn btn-primary w-full py-3 rounded-md text-white bg-purple-600 hover:bg-purple-700 transition duration-300\"\r\n//           >\r\n//             Добавить товар\r\n//           </button>\r\n//         </div>\r\n//       </form>\r\n//     </div>\r\n//   );\r\n// }\r\n\"use server\";\r\n\r\nimport { db } from \"~/server/db\";\r\nimport { redirect } from \"next/navigation\";\r\nimport { randomUUID } from \"crypto\";\r\nimport { supabase } from \"../supabase/supabaseClient\";\r\n\r\nexport async function createProduct(formData: FormData) {\r\n  const name = formData.get(\"name\") as string;\r\n  const description = formData.get(\"description\") as string;\r\n  const price = Number(formData.get(\"price\"));\r\n  const categoryId = formData.get(\"categoryId\") as string;\r\n  const file = formData.get(\"image\") as File;\r\n\r\n  if (!file || !file.type.startsWith(\"image/\")) {\r\n    throw new Error(\"Некорректный файл изображения\");\r\n  }\r\n\r\n  // Чтение файла в Buffer\r\n  const arrayBuffer = await file.arrayBuffer();\r\n  const buffer = Buffer.from(arrayBuffer);\r\n\r\n  const fileExt = file.name.split(\".\").pop();\r\n  const filePath = `products/${randomUUID()}.${fileExt}`;\r\n\r\n  const { error: uploadError } = await supabase.storage\r\n    .from(\"products-images\")\r\n    .upload(filePath, buffer, {\r\n      contentType: file.type,\r\n    });\r\n\r\n  if (uploadError) {\r\n    throw new Error(\"Ошибка при загрузке изображения: \" + uploadError.message);\r\n  }\r\n\r\n  const { data } = supabase.storage\r\n    .from(\"products-images\")\r\n    .getPublicUrl(filePath);\r\n\r\n  const imageUrl = data.publicUrl;\r\n\r\n  // Сохранение продукта в БД\r\n  await db.product.create({\r\n    data: {\r\n      name,\r\n      description,\r\n      price,\r\n      categoryId,\r\n      imageUrl,\r\n    },\r\n  });\r\n\r\n  redirect(\"/products\"); // или куда тебе нужно\r\n}\r\n"],"names":[],"mappings":"AACA,oCAAoC;AACpC,yDAAyD;AAEzD,mDAAmD;AACnD,kDAAkD;AAElD,aAAa;AACb,4EAA4E;AAC5E,sFAAsF;AAEtF,4DAA4D;AAC5D,gBAAgB;AAChB,0FAA0F;AAC1F,mBAAmB;AACnB,wBAAwB;AACxB,0BAA0B;AAC1B,uBAAuB;AACvB,wHAAwH;AACxH,oDAAoD;AACpD,eAAe;AACf,iBAAiB;AAEjB,gBAAgB;AAChB,0FAA0F;AAC1F,sBAAsB;AACtB,+BAA+B;AAC/B,iCAAiC;AACjC,uBAAuB;AACvB,8HAA8H;AAC9H,oDAAoD;AACpD,uBAAuB;AACvB,eAAe;AACf,iBAAiB;AAEjB,gBAAgB;AAChB,gFAAgF;AAChF,mBAAmB;AACnB,yBAAyB;AACzB,2BAA2B;AAC3B,4BAA4B;AAC5B,uBAAuB;AACvB,wHAAwH;AACxH,gDAAgD;AAChD,eAAe;AACf,iBAAiB;AAEjB,gBAAgB;AAChB,sFAAsF;AACtF,WAAW;AACX,iBAAiB;AACjB,mBAAmB;AACnB,kBAAkB;AAClB,uBAAuB;AACvB,eAAe;AACf,uFAAuF;AACvF,OAAO;AACP,SAAS;AAET,gBAAgB;AAChB,iGAAiG;AACjG,oBAAoB;AACpB,8BAA8B;AAC9B,gCAAgC;AAChC,uBAAuB;AACvB,0HAA0H;AAC1H,cAAc;AACd,2DAA2D;AAC3D,2CAA2C;AAC3C,+DAA+D;AAC/D,kCAAkC;AAClC,0BAA0B;AAC1B,kBAAkB;AAClB,sBAAsB;AACtB,iBAAiB;AAEjB,gDAAgD;AAChD,oBAAoB;AACpB,4BAA4B;AAC5B,sIAAsI;AACtI,cAAc;AACd,6BAA6B;AAC7B,sBAAsB;AACtB,iBAAiB;AACjB,gBAAgB;AAChB,aAAa;AACb,OAAO;AACP,IAAI;;;;;;AAGJ;AACA;AACA;AACA;;AAFA;;;;;;;AAIO,eAAe,uCAAW,GAAX,cAAc,QAAkB;IACpD,MAAM,OAAO,SAAS,GAAG,CAAC;IAC1B,MAAM,cAAc,SAAS,GAAG,CAAC;IACjC,MAAM,QAAQ,OAAO,SAAS,GAAG,CAAC;IAClC,MAAM,aAAa,SAAS,GAAG,CAAC;IAChC,MAAM,OAAO,SAAS,GAAG,CAAC;IAE1B,IAAI,CAAC,QAAQ,CAAC,KAAK,IAAI,CAAC,UAAU,CAAC,WAAW;QAC5C,MAAM,IAAI,MAAM;IAClB;IAEA,wBAAwB;IACxB,MAAM,cAAc,MAAM,KAAK,WAAW;IAC1C,MAAM,SAAS,OAAO,IAAI,CAAC;IAE3B,MAAM,UAAU,KAAK,IAAI,CAAC,KAAK,CAAC,KAAK,GAAG;IACxC,MAAM,WAAW,CAAC,SAAS,EAAE,CAAA,GAAA,qGAAA,CAAA,aAAU,AAAD,IAAI,CAAC,EAAE,SAAS;IAEtD,MAAM,EAAE,OAAO,WAAW,EAAE,GAAG,MAAM,wIAAA,CAAA,WAAQ,CAAC,OAAO,CAClD,IAAI,CAAC,mBACL,MAAM,CAAC,UAAU,QAAQ;QACxB,aAAa,KAAK,IAAI;IACxB;IAEF,IAAI,aAAa;QACf,MAAM,IAAI,MAAM,sCAAsC,YAAY,OAAO;IAC3E;IAEA,MAAM,EAAE,IAAI,EAAE,GAAG,wIAAA,CAAA,WAAQ,CAAC,OAAO,CAC9B,IAAI,CAAC,mBACL,YAAY,CAAC;IAEhB,MAAM,WAAW,KAAK,SAAS;IAE/B,2BAA2B;IAC3B,MAAM,mHAAA,CAAA,KAAE,CAAC,OAAO,CAAC,MAAM,CAAC;QACtB,MAAM;YACJ;YACA;YACA;YACA;YACA;QACF;IACF;IAEA,CAAA,GAAA,oTAAA,CAAA,WAAQ,AAAD,EAAE,cAAc,sBAAsB;AAC/C;;;IA9CsB;;AAAA,8WAAA"}},
    {"offset": {"line": 164, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 176, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":""}},
    {"offset": {"line": 178, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}}]
}