{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file://D%3A/PP_2/KRB2/12345%20%E2%80%94%20%D0%BA%D0%BE%D0%BF%D0%B8%D1%8F%20%E2%80%94%20%D0%BA%D0%BE%D0%BF%D0%B8%D1%8F/rater/src/app/_components/cart/cardDelete.tsx/proxy.mjs"],"sourcesContent":["import { registerClientReference } from \"react-server-dom-turbopack/server.edge\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/app/_components/cart/cardDelete.tsx <module evaluation> from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/app/_components/cart/cardDelete.tsx <module evaluation>\",\n    \"default\",\n);\n"],"names":[],"mappings":";;;AAAA;;uCACe,CAAA,GAAA,oWAAA,CAAA,0BAAuB,AAAD,EACjC;IAAa,MAAM,IAAI,MAAM;AAA2S,GACxU,yEACA"}},
    {"offset": {"line": 15, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 21, "column": 0}, "map": {"version":3,"sources":["file://D%3A/PP_2/KRB2/12345%20%E2%80%94%20%D0%BA%D0%BE%D0%BF%D0%B8%D1%8F%20%E2%80%94%20%D0%BA%D0%BE%D0%BF%D0%B8%D1%8F/rater/src/app/_components/cart/cardDelete.tsx/proxy.mjs"],"sourcesContent":["import { registerClientReference } from \"react-server-dom-turbopack/server.edge\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/app/_components/cart/cardDelete.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/app/_components/cart/cardDelete.tsx\",\n    \"default\",\n);\n"],"names":[],"mappings":";;;AAAA;;uCACe,CAAA,GAAA,oWAAA,CAAA,0BAAuB,AAAD,EACjC;IAAa,MAAM,IAAI,MAAM;AAAuR,GACpT,qDACA"}},
    {"offset": {"line": 29, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 35, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":""}},
    {"offset": {"line": 39, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 45, "column": 0}, "map": {"version":3,"sources":["file://D%3A/PP_2/KRB2/12345%20%E2%80%94%20%D0%BA%D0%BE%D0%BF%D0%B8%D1%8F%20%E2%80%94%20%D0%BA%D0%BE%D0%BF%D0%B8%D1%8F/rater/src/app/_components/cart/cardUpdate.tsx/proxy.mjs"],"sourcesContent":["import { registerClientReference } from \"react-server-dom-turbopack/server.edge\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/app/_components/cart/cardUpdate.tsx <module evaluation> from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/app/_components/cart/cardUpdate.tsx <module evaluation>\",\n    \"default\",\n);\n"],"names":[],"mappings":";;;AAAA;;uCACe,CAAA,GAAA,oWAAA,CAAA,0BAAuB,AAAD,EACjC;IAAa,MAAM,IAAI,MAAM;AAA2S,GACxU,yEACA"}},
    {"offset": {"line": 53, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 59, "column": 0}, "map": {"version":3,"sources":["file://D%3A/PP_2/KRB2/12345%20%E2%80%94%20%D0%BA%D0%BE%D0%BF%D0%B8%D1%8F%20%E2%80%94%20%D0%BA%D0%BE%D0%BF%D0%B8%D1%8F/rater/src/app/_components/cart/cardUpdate.tsx/proxy.mjs"],"sourcesContent":["import { registerClientReference } from \"react-server-dom-turbopack/server.edge\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/app/_components/cart/cardUpdate.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/app/_components/cart/cardUpdate.tsx\",\n    \"default\",\n);\n"],"names":[],"mappings":";;;AAAA;;uCACe,CAAA,GAAA,oWAAA,CAAA,0BAAuB,AAAD,EACjC;IAAa,MAAM,IAAI,MAAM;AAAuR,GACpT,qDACA"}},
    {"offset": {"line": 67, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 73, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":""}},
    {"offset": {"line": 77, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 82, "column": 0}, "map": {"version":3,"sources":["turbopack://[next]/internal/font/google/pacifico_e6dd6900.module.css [app-client] (css module)"],"sourcesContent":["__turbopack_export_value__({\n  \"className\": \"pacifico_e6dd6900-module__m2Nfkq__className\",\n  \"variable\": \"pacifico_e6dd6900-module__m2Nfkq__variable\",\n});\n"],"names":[],"mappings":"AAAA;AACA;AACA;AACA","ignoreList":[0]}},
    {"offset": {"line": 86, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 92, "column": 0}, "map": {"version":3,"sources":["turbopack://[next]/internal/font/google/pacifico_e6dd6900.js"],"sourcesContent":["import cssModule from \"@vercel/turbopack-next/internal/font/google/cssmodule.module.css?{%22path%22:%22font.ts%22,%22import%22:%22Pacifico%22,%22arguments%22:[{%22subsets%22:[%22cyrillic%22,%22latin%22],%22weight%22:%22400%22,%22variable%22:%22--font-pacifico%22}],%22variableName%22:%22pacifico%22}\";\nconst fontData = {\n    className: cssModule.className,\n    style: {\n        fontFamily: \"'Pacifico', 'Pacifico Fallback'\",\n        fontWeight: 400,\nfontStyle: \"normal\",\n\n    },\n};\n\nif (cssModule.variable != null) {\n    fontData.variable = cssModule.variable;\n}\n\nexport default fontData;\n"],"names":[],"mappings":";;;AAAA;;AACA,MAAM,WAAW;IACb,WAAW,2JAAA,CAAA,UAAS,CAAC,SAAS;IAC9B,OAAO;QACH,YAAY;QACZ,YAAY;QACpB,WAAW;IAEP;AACJ;AAEA,IAAI,2JAAA,CAAA,UAAS,CAAC,QAAQ,IAAI,MAAM;IAC5B,SAAS,QAAQ,GAAG,2JAAA,CAAA,UAAS,CAAC,QAAQ;AAC1C;uCAEe","ignoreList":[0]}},
    {"offset": {"line": 109, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 114, "column": 0}, "map": {"version":3,"sources":["turbopack://[next]/internal/font/google/montserrat_73a33bbe.module.css [app-client] (css module)"],"sourcesContent":["__turbopack_export_value__({\n  \"className\": \"montserrat_73a33bbe-module__-d_Rcq__className\",\n  \"variable\": \"montserrat_73a33bbe-module__-d_Rcq__variable\",\n});\n"],"names":[],"mappings":"AAAA;AACA;AACA;AACA","ignoreList":[0]}},
    {"offset": {"line": 118, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 124, "column": 0}, "map": {"version":3,"sources":["turbopack://[next]/internal/font/google/montserrat_73a33bbe.js"],"sourcesContent":["import cssModule from \"@vercel/turbopack-next/internal/font/google/cssmodule.module.css?{%22path%22:%22font.ts%22,%22import%22:%22Montserrat%22,%22arguments%22:[{%22subsets%22:[%22cyrillic%22,%22latin%22],%22variable%22:%22--font-montserrat%22}],%22variableName%22:%22montserrat%22}\";\nconst fontData = {\n    className: cssModule.className,\n    style: {\n        fontFamily: \"'Montserrat', 'Montserrat Fallback'\",\n        fontStyle: \"normal\",\n\n    },\n};\n\nif (cssModule.variable != null) {\n    fontData.variable = cssModule.variable;\n}\n\nexport default fontData;\n"],"names":[],"mappings":";;;AAAA;;AACA,MAAM,WAAW;IACb,WAAW,6JAAA,CAAA,UAAS,CAAC,SAAS;IAC9B,OAAO;QACH,YAAY;QACZ,WAAW;IAEf;AACJ;AAEA,IAAI,6JAAA,CAAA,UAAS,CAAC,QAAQ,IAAI,MAAM;IAC5B,SAAS,QAAQ,GAAG,6JAAA,CAAA,UAAS,CAAC,QAAQ;AAC1C;uCAEe","ignoreList":[0]}},
    {"offset": {"line": 140, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 146, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":""}},
    {"offset": {"line": 151, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 167, "column": 0}, "map": {"version":3,"sources":["file://D%3A/PP_2/KRB2/12345%20%E2%80%94%20%D0%BA%D0%BE%D0%BF%D0%B8%D1%8F%20%E2%80%94%20%D0%BA%D0%BE%D0%BF%D0%B8%D1%8F/rater/src/app/_components/empty/cartEmpty.tsx"],"sourcesContent":["import Link from \"next/link\";\r\nimport Image from \"next/image\";\r\nimport { db } from \"~/server/db\";\r\n\r\nexport default async function EmptyCart() {\r\n  const placeholderImage = await db.placeholderImage.findFirst({\r\n    where: { name: \"Корзина пустая\" },\r\n  });\r\n\r\n  return (\r\n    <div className=\"flex flex-col items-center justify-center gap-6 p-8 text-center\">\r\n      {placeholderImage && (\r\n        <div className=\"relative w-full max-w-[500px] h-[400px]\">\r\n          <Image\r\n            src={placeholderImage.imageUrl}\r\n            alt=\"Пустая корзина\"\r\n            fill\r\n            style={{\r\n              objectFit: 'contain',\r\n            }}\r\n            className=\"drop-shadow-lg\"\r\n            unoptimized={true}\r\n            priority \r\n          />\r\n        </div>\r\n      )}\r\n      <p className=\"text-xl text-gray-700 mt-4\">\r\n        Корзина пуста.{\" \"}\r\n        <Link \r\n          href=\"/catalog\" \r\n          className=\"text-blue-600 underline hover:text-blue-800 font-medium\"\r\n        >\r\n          Перейти в каталог\r\n        </Link>\r\n      </p>\r\n    </div>\r\n  );\r\n}"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;;AAEe,eAAe;IAC5B,MAAM,mBAAmB,MAAM,mHAAA,CAAA,KAAE,CAAC,gBAAgB,CAAC,SAAS,CAAC;QAC3D,OAAO;YAAE,MAAM;QAAiB;IAClC;IAEA,qBACE,6VAAC;QAAI,WAAU;;YACZ,kCACC,6VAAC;gBAAI,WAAU;0BACb,cAAA,6VAAC,4OAAA,CAAA,UAAK;oBACJ,KAAK,iBAAiB,QAAQ;oBAC9B,KAAI;oBACJ,IAAI;oBACJ,OAAO;wBACL,WAAW;oBACb;oBACA,WAAU;oBACV,aAAa;oBACb,QAAQ;;;;;;;;;;;0BAId,6VAAC;gBAAE,WAAU;;oBAA6B;oBACzB;kCACf,6VAAC,2QAAA,CAAA,UAAI;wBACH,MAAK;wBACL,WAAU;kCACX;;;;;;;;;;;;;;;;;;AAMT"}},
    {"offset": {"line": 236, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 242, "column": 0}, "map": {"version":3,"sources":["file://D%3A/PP_2/KRB2/12345%20%E2%80%94%20%D0%BA%D0%BE%D0%BF%D0%B8%D1%8F%20%E2%80%94%20%D0%BA%D0%BE%D0%BF%D0%B8%D1%8F/rater/src/app/_components/cart/updateQuantity.tsx/proxy.mjs"],"sourcesContent":["import { registerClientReference } from \"react-server-dom-turbopack/server.edge\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/app/_components/cart/updateQuantity.tsx <module evaluation> from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/app/_components/cart/updateQuantity.tsx <module evaluation>\",\n    \"default\",\n);\n"],"names":[],"mappings":";;;AAAA;;uCACe,CAAA,GAAA,oWAAA,CAAA,0BAAuB,AAAD,EACjC;IAAa,MAAM,IAAI,MAAM;AAA+S,GAC5U,6EACA"}},
    {"offset": {"line": 250, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 256, "column": 0}, "map": {"version":3,"sources":["file://D%3A/PP_2/KRB2/12345%20%E2%80%94%20%D0%BA%D0%BE%D0%BF%D0%B8%D1%8F%20%E2%80%94%20%D0%BA%D0%BE%D0%BF%D0%B8%D1%8F/rater/src/app/_components/cart/updateQuantity.tsx/proxy.mjs"],"sourcesContent":["import { registerClientReference } from \"react-server-dom-turbopack/server.edge\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/app/_components/cart/updateQuantity.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/app/_components/cart/updateQuantity.tsx\",\n    \"default\",\n);\n"],"names":[],"mappings":";;;AAAA;;uCACe,CAAA,GAAA,oWAAA,CAAA,0BAAuB,AAAD,EACjC;IAAa,MAAM,IAAI,MAAM;AAA2R,GACxT,yDACA"}},
    {"offset": {"line": 264, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 270, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":""}},
    {"offset": {"line": 274, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 290, "column": 0}, "map": {"version":3,"sources":["file://D%3A/PP_2/KRB2/12345%20%E2%80%94%20%D0%BA%D0%BE%D0%BF%D0%B8%D1%8F%20%E2%80%94%20%D0%BA%D0%BE%D0%BF%D0%B8%D1%8F/rater/src/app/cart/page.tsx"],"sourcesContent":["import { auth } from \"~/server/auth\";\nimport { db } from \"~/server/db\";\nimport Link from \"next/link\";\nimport RemoveFromCartButton from \"../_components/cart/cardDelete\";\nimport CheckoutButton from \"../_components/cart/cardUpdate\";\nimport { pacifico } from \"~/lib/font\";\nimport EmptyCart from \"../_components/empty/cartEmpty\";\nimport QuantityControl from \"../_components/cart/updateQuantity\";\nimport { url } from \"inspector\";\n\nexport default async function CartPage() {\n  const session = await auth();\n\n  if (!session?.user) {\n    return (\n      <p className=\"p-6\">\n        Пожалуйста,{\" \"}\n        <Link href=\"/api/auth/signin\" className=\"text-blue-500 underline\">\n          войдите в систему\n        </Link>\n        , чтобы просматривать корзину.\n      </p>\n    );\n  }\n\n  const cartItems = await db.cartItem.findMany({\n    where: { userId: session.user.id },\n    include: {\n      product: {\n        include: {\n          images: true,\n        },\n      },\n    },\n  });\n\n  const total = cartItems.reduce(\n    (sum, item) => sum + item.quantity * item.product.price,\n    0\n  );\n\n  return (\n    <main className=\"p-6 max-w-4xl mx-auto\">\n      <h1\n        className={`${pacifico.className} text-4xl text-center mb-8 text-transparent bg-clip-text bg-gradient-to-r from-purple-600 to-pink-600`}\n      >\n        Моя корзина\n      </h1>\n\n      {cartItems.length === 0 ? (\n        <EmptyCart />\n      ) : (\n        <div className=\"space-y-6\">\n          {cartItems.map((item) => (\n            <div\n              key={item.id}\n              className=\"flex flex-col md:flex-row justify-between gap-4 p-6 border border-purple-200 rounded-xl shadow-md hover:shadow-xl transition duration-300 bg-gradient-to-br from-purple-100 via-pink-100 to-pink-200\"\n            >\n              <div className=\"flex items-center gap-4\">\n                <img\n                  src={item.product.images[0]?.url}\n                  alt={item.product.name}\n                  width={100}\n                  height={100}\n                  className=\"rounded\"\n                />\n                <div>\n                  <h2 className=\"text-lg font-semibold text-purple-800\">\n                    {item.product.name}\n                  </h2>\n                  <div className=\"text-sm text-gray-700 flex items-center gap-2\">\n  Количество:\n  <QuantityControl\n    itemId={item.id}\n    quantity={item.quantity}\n    stock={item.product.stock}\n  />\n</div>\n                  <p className=\"text-sm text-gray-700\">\n                    Цена за шт: {item.product.price.toString()} ₽\n                  </p>\n                  <p className=\"font-medium text-purple-900\">\n                    Итого: {item.quantity * item.product.price} ₽\n                  </p>\n                </div>\n              </div>\n\n              <div className=\"flex flex-col md:items-end gap-2 mt-4 md:mt-0\">\n                <CheckoutButton\n                  userId={session.user.id}\n                  productId={item.product.id}\n                  quantity={item.quantity}\n                  price={item.product.price}\n                  id={item.id}\n                  stock={item.product.stock}\n                />\n                <RemoveFromCartButton itemId={item.id} />\n              </div>\n            </div>\n          ))}\n\n          <div className=\"text-right mt-6\">\n            <h2 className=\"text-xl font-bold\">Общая сумма: {total} ₽</h2>\n\n            {cartItems.length > 1 && (\n              <form action=\"\" className=\"mt-4 inline-block\">\n                <button\n                  type=\"submit\"\n                  className=\"bg-purple-600 hover:bg-purple-700 text-white font-semibold py-2 px-6 rounded-lg shadow\"\n                >\n                  Оформить всю корзину\n                </button>\n              </form>\n            )}\n          </div>\n        </div>\n      )}\n    </main>\n  );\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAFA;;;;;;;;;;AAKe,eAAe;IAC5B,MAAM,UAAU,MAAM,CAAA,GAAA,8HAAA,CAAA,OAAI,AAAD;IAEzB,IAAI,CAAC,SAAS,MAAM;QAClB,qBACE,6VAAC;YAAE,WAAU;;gBAAM;gBACL;8BACZ,6VAAC,2QAAA,CAAA,UAAI;oBAAC,MAAK;oBAAmB,WAAU;8BAA0B;;;;;;gBAE3D;;;;;;;IAIb;IAEA,MAAM,YAAY,MAAM,mHAAA,CAAA,KAAE,CAAC,QAAQ,CAAC,QAAQ,CAAC;QAC3C,OAAO;YAAE,QAAQ,QAAQ,IAAI,CAAC,EAAE;QAAC;QACjC,SAAS;YACP,SAAS;gBACP,SAAS;oBACP,QAAQ;gBACV;YACF;QACF;IACF;IAEA,MAAM,QAAQ,UAAU,MAAM,CAC5B,CAAC,KAAK,OAAS,MAAM,KAAK,QAAQ,GAAG,KAAK,OAAO,CAAC,KAAK,EACvD;IAGF,qBACE,6VAAC;QAAK,WAAU;;0BACd,6VAAC;gBACC,WAAW,GAAG,mLAAA,CAAA,WAAQ,CAAC,SAAS,CAAC,qGAAqG,CAAC;0BACxI;;;;;;YAIA,UAAU,MAAM,KAAK,kBACpB,6VAAC,gJAAA,CAAA,UAAS;;;;qCAEV,6VAAC;gBAAI,WAAU;;oBACZ,UAAU,GAAG,CAAC,CAAC,qBACd,6VAAC;4BAEC,WAAU;;8CAEV,6VAAC;oCAAI,WAAU;;sDACb,6VAAC;4CACC,KAAK,KAAK,OAAO,CAAC,MAAM,CAAC,EAAE,EAAE;4CAC7B,KAAK,KAAK,OAAO,CAAC,IAAI;4CACtB,OAAO;4CACP,QAAQ;4CACR,WAAU;;;;;;sDAEZ,6VAAC;;8DACC,6VAAC;oDAAG,WAAU;8DACX,KAAK,OAAO,CAAC,IAAI;;;;;;8DAEpB,6VAAC;oDAAI,WAAU;;wDAAgD;sEAE/E,6VAAC,oJAAA,CAAA,UAAe;4DACd,QAAQ,KAAK,EAAE;4DACf,UAAU,KAAK,QAAQ;4DACvB,OAAO,KAAK,OAAO,CAAC,KAAK;;;;;;;;;;;;8DAGX,6VAAC;oDAAE,WAAU;;wDAAwB;wDACtB,KAAK,OAAO,CAAC,KAAK,CAAC,QAAQ;wDAAG;;;;;;;8DAE7C,6VAAC;oDAAE,WAAU;;wDAA8B;wDACjC,KAAK,QAAQ,GAAG,KAAK,OAAO,CAAC,KAAK;wDAAC;;;;;;;;;;;;;;;;;;;8CAKjD,6VAAC;oCAAI,WAAU;;sDACb,6VAAC,gJAAA,CAAA,UAAc;4CACb,QAAQ,QAAQ,IAAI,CAAC,EAAE;4CACvB,WAAW,KAAK,OAAO,CAAC,EAAE;4CAC1B,UAAU,KAAK,QAAQ;4CACvB,OAAO,KAAK,OAAO,CAAC,KAAK;4CACzB,IAAI,KAAK,EAAE;4CACX,OAAO,KAAK,OAAO,CAAC,KAAK;;;;;;sDAE3B,6VAAC,gJAAA,CAAA,UAAoB;4CAAC,QAAQ,KAAK,EAAE;;;;;;;;;;;;;2BAzClC,KAAK,EAAE;;;;;kCA8ChB,6VAAC;wBAAI,WAAU;;0CACb,6VAAC;gCAAG,WAAU;;oCAAoB;oCAAc;oCAAM;;;;;;;4BAErD,UAAU,MAAM,GAAG,mBAClB,6VAAC;gCAAK,QAAO;gCAAG,WAAU;0CACxB,cAAA,6VAAC;oCACC,MAAK;oCACL,WAAU;8CACX;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAUjB"}},
    {"offset": {"line": 535, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 547, "column": 0}, "map": {"version":3,"sources":["file://D%3A/PP_2/KRB2/12345%20%E2%80%94%20%D0%BA%D0%BE%D0%BF%D0%B8%D1%8F%20%E2%80%94%20%D0%BA%D0%BE%D0%BF%D0%B8%D1%8F/rater/src/app/api/action/cart.ts"],"sourcesContent":["\"use server\";\r\n\r\nimport { revalidatePath } from \"next/cache\";\r\nimport { redirect } from \"next/navigation\";\r\nimport { z } from \"zod\";\r\nimport { db } from \"~/server/db\";\r\n\r\nexport async function deleteCartProduct(formData: FormData) {\r\n    const fd = z\r\n      .object({\r\n        id: z.string(),\r\n      })\r\n      .parse({\r\n        id: formData.get(\"id\"),\r\n      });\r\n    await db.cartItem.delete({ where: { id: fd.id } });\r\n    redirect(\"/cart\");\r\n  }\r\n\r\n\r\n  export async function updateCartItemQuantity(itemId: string, newQuantity: number) {\r\n    try {\r\n      await db.cartItem.update({\r\n        where: { id: itemId },\r\n        data: { quantity: newQuantity },\r\n      });\r\n  \r\n      revalidatePath(\"/cart\"); // или точный путь, если используется динамика\r\n    } catch (error) {\r\n      console.error(\"Ошибка при обновлении количества:\", error);\r\n      throw new Error(\"Не удалось обновить количество\");\r\n    }\r\n  }\r\n  // export async function addProductDelivery(formData: FormData) {\r\n  //   const fd = z.object({\r\n  //       id: z.string(),\r\n  //     userId: z.string(),\r\n  //     productId: z.string(),\r\n  //     quantity: z.string().transform(Number), \r\n  //     price: z.string().transform(Number),\r\n  //   }).parse({\r\n  //     userId: formData.get(\"userId\"),\r\n  //     productId: formData.get(\"productId\"),\r\n  //     quantity: formData.get(\"quantity\"),\r\n  //     price: formData.get(\"price\"),\r\n  //     id: formData.get(\"id\"),\r\n  //   });\r\n  \r\n    // const order = await db.order.create({\r\n    //   data: {\r\n    //     userId: fd.userId,\r\n    //     totalAmount: fd.price * fd.quantity,\r\n    //   },\r\n    // });\r\n  \r\n    // await db.orderItem.create({\r\n    //   data: {\r\n    //     orderId: order.id,\r\n    //     productId: fd.productId,\r\n    //     quantity: fd.quantity,\r\n    //     price: fd.price,\r\n    //   },\r\n    // });\r\n  //   await db.cartItem.delete({ where: { id: fd.id } });\r\n  //   redirect(\"/cart\");\r\n  // }\r\n\r\n\r\nexport async function addProductDelivery(formData: FormData) {\r\n  // Парсим данные из формы\r\n  const fd = z.object({\r\n    id: z.string(),\r\n    userId: z.string(),\r\n    productId: z.string(),\r\n    quantity: z.string().transform(Number),\r\n    price: z.string().transform(Number),\r\n  }).parse({\r\n    userId: formData.get(\"userId\"),\r\n    productId: formData.get(\"productId\"),\r\n    quantity: formData.get(\"quantity\"),\r\n    price: formData.get(\"price\"),\r\n    id: formData.get(\"id\"),\r\n  });\r\n\r\n  // Получаем информацию о товаре из базы данных\r\n  const product = await db.product.findUnique({\r\n    where: { id: fd.productId },\r\n  });\r\n\r\n  if (product) {\r\n    // Убедитесь, что product не равно null\r\n    const updatedStock = product.stock - fd.quantity;\r\n  \r\n    // Обновляем количество товара в базе данных, если оно больше или равно 0\r\n    if (updatedStock >= 0) {\r\n      await db.product.update({\r\n        where: { id: fd.productId },\r\n        data: {\r\n          stock: updatedStock,\r\n        },\r\n      });\r\n  \r\n      // Оформление заказа и удаление товара из корзины\r\n      const order =  await db.order.create({\r\n        data: {\r\n          userId: fd.userId,\r\n          totalAmount: fd.price * fd.quantity,\r\n        },\r\n      });\r\n  \r\n      await db.orderItem.create({\r\n        data: {\r\n          orderId: order.id,\r\n          productId: fd.productId,\r\n          quantity: fd.quantity,\r\n          price: fd.price,\r\n        },\r\n      });\r\n  \r\n      await db.cartItem.delete({ where: { id: fd.id } });\r\n      redirect(\"/cart\");\r\n    } else {\r\n      throw new Error(\"Недостаточно товара на складе\");\r\n    }\r\n  } else {\r\n    throw new Error(\"Товар не найден\");\r\n  }\r\n}"],"names":[],"mappings":"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"}},
    {"offset": {"line": 666, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 672, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":""}},
    {"offset": {"line": 676, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}}]
}